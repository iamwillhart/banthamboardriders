---
/**
 * HeroHomepage
 *
 * KB RATING: A* (0KB JS â€” pure CSS)
 * CARBON TIER: A (image-heavy, but single image load)
 *
 * Full-viewport hero with background image and text overlay.
 * Perfect for landing pages and dramatic opening statements.
 *
 * ============================================================
 * ðŸš€ NEW CLIENT SETUP â€” follow these steps:
 * ============================================================
 *
 * STEP 1: Set position (line ~99)
 *   Change "bottom-left" to your chosen position.
 *   Options: "bottom-left" | "left" | "center" | "right" | "bottom-right"
 *
 * STEP 2: Set height (line ~100)
 *   Change "large" to your chosen height.
 *   Options: "large" (90vh) | "full" (100vh) | "medium" (70vh)
 *
 * STEP 3: Set overlay darkness (line ~102)
 *   Change 40 to your chosen opacity (0-100).
 *   Light images need higher (50-60), dark images need lower (20-30).
 *
 * STEP 4: Set container width (line ~103)
 *   Options: "full" (text aligns with nav) | "contained" (1200px, matches other slices)
 *
 * STEP 5: Update CSS to match (bottom of file)
 *   Only ONE position variant should be active in CSS.
 *   Only ONE height variant should be active in CSS.
 *   Delete or comment out the variants you're not using.
 *
 * ============================================================
 * ðŸ“ PRISMIC FIELDS (client controls in CMS)
 * ============================================================
 *   - heading (Key Text) â€” main H1 text
 *   - tagline (Key Text) â€” supporting text
 *   - image (Image) â€” background image
 *   - logo (Image) â€” optional centered logo overlay
 *   - button_label (Key Text) â€” button text
 *   - button_link (Link) â€” button destination
 *
 * ============================================================
 */
import { linkResolver } from "../../lib/prismic";
import * as prismic from "@prismicio/client";

interface Props {
  // Prismic fields
  heading: string;
  tagline?: string;
  image?: {
    url?: string;
    alt?: string;
    mobile?: { url?: string; alt?: string };
  };
  logo?: { url?: string; alt?: string };
  button_label?: string;
  button_link?: { url?: string } | string;
  // Developer overrides (for direct Astro use, rare)
  primaryCta?: { label: string; href: string };
  secondaryCta?: { label: string; href: string };
  contentPosition?:
    | "left"
    | "center"
    | "right"
    | "bottom-left"
    | "bottom-right";
  overlayOpacity?: number;
  minHeight?: "full" | "large" | "medium";
  containerWidth?: "full" | "contained";
}

const {
  heading,
  tagline,
  image: prismicImage,
  logo: prismicLogo,
  button_label,
  button_link,
  primaryCta: directCta,
  secondaryCta,
  contentPosition: directPosition,
  overlayOpacity: directOverlay,
  minHeight: directHeight,
  containerWidth: directContainerWidth,
} = Astro.props;

// Prismic Link fields are objects { url: "..." }, not strings â€” extract the URL
const getUrl = (link: any): string => {
  if (!link) return "#";
  if (typeof link === "string") return link;
  return prismic.asLink(link, { linkResolver }) || "#";
};

// Prismic Image fields use "url" not "src" â€” normalize for <img>
const image = prismicImage
  ? { src: prismicImage.url || "", alt: prismicImage.alt || heading || "" }
  : { src: "", alt: "" };

// Mobile responsive view from Prismic (900Ã—1600 portrait crop)
const mobileImageSrc = prismicImage?.mobile?.url || "";

// Normalize logo image (optional)
const logo = prismicLogo
  ? { src: prismicLogo.url || "", alt: prismicLogo.alt || "" }
  : null;

// Only create button if label exists â€” prevents empty button rendering
const primaryCta =
  directCta ||
  (button_label ? { label: button_label, href: getUrl(button_link) } : null);

// ============================================================
// ðŸŽ¨ DEVELOPER SETTINGS â€” change these per client (Steps 1-4)
// ============================================================
const contentPosition = directPosition || "bottom-right"; // Step 1 Options: "bottom-left" | "left" | "center" | "right" | "bottom-right"
const minHeight = directHeight || "large"; // Step 2 Options: "large" (90vh) | "full" (100vh) | "medium" (70vh)
const overlayOpacity = directOverlay ?? 0; // Step 3
const containerWidth = directContainerWidth || "full"; // Step 4 Options: "full" (aligns with nav) | "contained" (1200px, matches other slices)
// ============================================================
---

<section
  class:list={[
    "hero-homepage",
    `hero-homepage--${contentPosition}`,
    `hero-homepage--${minHeight}`,
    `hero-homepage--container-${containerWidth}`,
  ]}
  style={`--overlay-opacity: ${overlayOpacity / 100}`}
>
  <div class="hero-homepage__bg">
    <picture>
      <source media="(max-width: 767px)" srcset={mobileImageSrc || image.src} />
      <img
        src={image.src}
        alt={image.alt}
        loading="eager"
        fetchpriority="high"
      />
    </picture>
  </div>

  <div class="hero-homepage__overlay"></div>

  {
    logo && (
      <div class="hero-homepage__logo">
        <img src={logo.src} alt={logo.alt} loading="eager" />
      </div>
    )
  }

  <div class="hero-homepage__container">
    <div class="hero-homepage__content">
      <h1 class="hero-homepage__heading">{heading}</h1>
      {tagline && <p class="hero-homepage__tagline">{tagline}</p>}
      {
        (primaryCta || secondaryCta) && (
          <div class="hero-homepage__actions">
            {primaryCta && (
              <a href={primaryCta.href} class="btn btn--primary-inverted">
                {primaryCta.label}
              </a>
            )}
            {secondaryCta && (
              <a href={secondaryCta.href} class="btn btn--secondary-inverted">
                {secondaryCta.label}
              </a>
            )}
          </div>
        )
      }
    </div>
  </div>
</section>

<style>
  /* ============================================================
     BASE STYLES (keep these)
     ============================================================ */
  .hero-homepage {
    position: relative;
    display: flex;
    width: 100%;
    overflow: hidden;
    color: var(--color-bg);
  }

  .hero-homepage__bg {
    position: absolute;
    inset: 0;
    z-index: 0;
  }

  .hero-homepage__bg picture {
    display: block;
    width: 100%;
    height: 100%;
  }

  .hero-homepage__bg img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .hero-homepage__overlay {
    position: absolute;
    inset: 0;
    background-color: rgba(0, 0, 0, var(--overlay-opacity, 0.4));
    z-index: 1;
  }

  /* ============================================================
     CENTERED LOGO (optional â€” from Prismic "logo" field)
     ============================================================ */
  .hero-homepage__logo {
    position: absolute;
    top: 64px;
    right: 0;
    bottom: 0;
    left: 0;
    z-index: 2;
    display: flex;
    align-items: center;
    justify-content: center;
    pointer-events: none;
  }

  .hero-homepage__logo img {
    max-height: 100%;
    width: auto;
    height: auto;
    object-fit: contain;
    pointer-events: auto;
  }

  @media (min-width: 768px) {
    .hero-homepage__logo {
      top: 80px;
    }
  }

  .hero-homepage__container {
    position: relative;
    z-index: 3;
    width: 100%;
    min-width: 0;
    margin-inline: auto;
    padding: var(--space-16) var(--gutter);
    display: flex;
  }

  @media (min-width: 768px) {
    .hero-homepage__container {
      padding: var(--space-24) var(--gutter-lg);
    }
  }

  /* .hero-homepage__content {
    max-width: 30ch;
  } */

  /* ============================================================
     CONTAINER WIDTH VARIANTS (Step 4)
     ============================================================ */
  /* Full â€” text aligns with nav/gutter (default) */
  .hero-homepage--container-full .hero-homepage__container {
    max-width: none;
  }

  /* Contained â€” matches other slice widths (1200px) */
  .hero-homepage--container-contained .hero-homepage__container {
    max-width: var(--container-xl);
  }

  /* ============================================================
     ACTIVE HEIGHT VARIANT (Step 4 â€” keep only ONE)
     ============================================================ */
  .hero-homepage--large {
    min-height: 90vh;
    min-height: 90dvh;
  }

  .hero-homepage--full {
    min-height: 100vh;
    min-height: 100dvh;
  }

  .hero-homepage--medium {
    min-height: 70vh;
  }

  /* ============================================================
     ACTIVE POSITION VARIANT (Step 4 â€” keep only ONE)
     ============================================================ */

  /* Bottom Left */
  .hero-homepage--bottom-left .hero-homepage__container {
    align-items: flex-end;
    justify-content: flex-start;
  }

  /* Left (vertically centered) */
  .hero-homepage--left .hero-homepage__container {
    align-items: center;
    justify-content: flex-start;
  }

  /* Center */
  .hero-homepage--center .hero-homepage__container {
    align-items: center;
    justify-content: center;
    text-align: center;
  }
  .hero-homepage--center .hero-homepage__content {
    max-width: 60ch;
  }
  .hero-homepage--center .hero-homepage__actions {
    justify-content: center;
  }

  /* Right (vertically centered) */
  .hero-homepage--right .hero-homepage__container {
    align-items: center;
    justify-content: flex-end;
    text-align: right;
  }
  .hero-homepage--right .hero-homepage__actions {
    justify-content: flex-end;
  }

  /* Bottom Right â€” revert to simple version, no min() hack needed */
  .hero-homepage--bottom-right .hero-homepage__container {
    align-items: flex-end;
    justify-content: flex-end;
    text-align: right;
  }
  .hero-homepage--bottom-right .hero-homepage__actions {
    justify-content: flex-end;
  }

  /* ============================================================
     TYPOGRAPHY
     ============================================================ */
  /* HEADING â€” allow long words to break */
  .hero-homepage__heading {
    font-family: var(--font-serif);
    font-size: clamp(var(--text-4xl), 7vw, var(--text-6xl));
    font-weight: var(--font-medium);
    line-height: var(--leading-snug);
    text-shadow: 0 2px 20px rgba(0, 0, 0, 0.3);
    overflow-wrap: break-word;
  }

  .hero-homepage__tagline {
    font-size: var(--text-lg);
    line-height: var(--leading-relaxed);
    opacity: 0.9;
    margin-bottom: var(--space-4);
    text-shadow: 0 1px 10px rgba(0, 0, 0, 0.3);
    max-width: 45ch;
  }

  @media (min-width: 768px) {
    .hero-homepage__tagline {
      font-size: var(--text-xl);
    }
  }

  /* ============================================================
     BUTTONS
     ============================================================ */
  .hero-homepage__actions {
    display: flex;
    gap: var(--space-4);
    flex-wrap: wrap;
  }
</style>
