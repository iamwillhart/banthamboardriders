---
/**
 * Homepage
 * 
 * Fetches content from Prismic "homepage" single type.
 * Build in Prismic using the available slices.
 */
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import SliceZone from '../components/SliceZone.astro';
import { client, getSettings } from '../lib/prismic';

// Fetch homepage and settings from Prismic
let page;
let slices = [];
const settings = await getSettings();

try {
  page = await client.getSingle('homepage');
  slices = page.data.body || [];
} catch (error) {
  // Homepage not found in Prismic - show setup message in dev
  if (import.meta.env.DEV) {
    console.warn('Homepage not found in Prismic. Create a "homepage" document.');
  }
}

const title = page?.data?.meta_title || 'Home';
const description = page?.data?.meta_description || '';
// Social image: page-specific → settings default → none
const image = page?.data?.meta_image?.url || settings?.data?.default_og_image?.url || '';
---

<Layout title={title} description={description} image={image}>
  <Header />
  <main>
    {slices.length > 0 ? (
      <SliceZone slices={slices} />
    ) : (
      <section class="section">
        <div class="container">
          <div class="setup-message">
            <h1 class="heading-2">Welcome to your Prismic site</h1>
            <p class="text-body text-muted">
              Create a <strong>homepage</strong> document in Prismic to get started.
            </p>
            <p class="text-small text-muted">
              Need help? Check the README for setup instructions.
            </p>
          </div>
        </div>
      </section>
    )}
  </main>
  <Footer />
</Layout>

<style>
  .setup-message {
    text-align: center;
    padding: var(--space-16) 0;
    max-width: 40ch;
    margin: 0 auto;
  }
  
  .setup-message p {
    margin-top: var(--space-4);
  }
</style>
